<div
  id="define-shape-panel-container"
  class="p-3 space-y-3 bg-neutral-50/60 dark:bg-neutral-900/60 rounded-md"
>
  @if (!isActive()) {
    <button
      id="define-shape-create-button"
      type="button"
      (click)="onCreateShape()"
      [disabled]="!hasSelection()"
      class="w-full flex items-center gap-2 px-3 py-2 text-xs rounded border border-neutral-200/70 bg-neutral-50/60 text-neutral-700 hover:bg-neutral-200/70 dark:border-neutral-700/70 dark:bg-neutral-900/60 dark:text-neutral-300 dark:hover:bg-neutral-700/70 disabled:opacity-50 disabled:cursor-not-allowed"
    >
      <ng-icon
        id="define-shape-create-icon"
        name="heroSquares2x2"
        class="h-4 w-4"
      ></ng-icon>
      <span id="define-shape-create-label">{{
        "defineShape.createFromSelection" | transloco
      }}</span>
    </button>

    @if (!hasSelection()) {
      <div
        id="define-shape-no-selection-hint"
        class="text-xs text-neutral-500 dark:text-neutral-400 text-center py-2"
      >
        {{ "defineShape.noSelection" | transloco }}
      </div>
    }
  } @else {
    <div id="define-shape-preview-section" class="space-y-2">
      <div id="define-shape-thumbnail-row" class="flex items-start gap-3">
        <div id="define-shape-thumbnail-wrapper" class="space-y-1">
          <label
            id="define-shape-thumbnail-label"
            class="text-xs font-medium text-neutral-600 dark:text-neutral-400"
          >
            {{ "defineShape.thumbnail" | transloco }}
          </label>
          <div
            id="define-shape-thumbnail-container"
            class="w-16 h-16 border border-neutral-300 dark:border-neutral-600 rounded bg-white dark:bg-neutral-800 overflow-hidden"
          >
            @if (thumbnailSrc()) {
              <img
                id="define-shape-thumbnail-img"
                [src]="thumbnailSrc()"
                alt="Shape thumbnail"
                class="w-full h-full object-contain"
              />
            }
          </div>
        </div>

        <div id="define-shape-vector-preview-wrapper" class="space-y-1 flex-1">
          <label
            id="define-shape-vector-preview-label"
            class="text-xs font-medium text-neutral-600 dark:text-neutral-400"
          >
            {{ "defineShape.vectorPreview" | transloco }}
          </label>
          <div
            id="define-shape-vector-preview-container"
            class="w-full h-16 border border-neutral-300 dark:border-neutral-600 rounded bg-white dark:bg-neutral-800 overflow-hidden"
          >
            @if (vectorPreviewSrc()) {
              <img
                id="define-shape-vector-preview-img"
                [src]="vectorPreviewSrc()"
                alt="Shape vector preview"
                class="w-full h-full object-contain"
              />
            }
          </div>
        </div>
      </div>
    </div>

    <div id="define-shape-name-row" class="space-y-1">
      <label
        id="define-shape-name-label"
        for="define-shape-name-input"
        class="text-xs font-medium text-neutral-600 dark:text-neutral-400"
      >
        {{ "defineShape.name" | transloco }}
      </label>
      <input
        id="define-shape-name-input"
        type="text"
        [value]="shapeName()"
        (input)="onNameChange($event)"
        class="w-full px-2 py-1.5 text-xs border border-neutral-300/70 rounded bg-white dark:border-neutral-700/70 dark:bg-neutral-900 dark:text-neutral-100"
      />
    </div>

    <div id="define-shape-type-row" class="space-y-1">
      <label
        id="define-shape-type-label"
        for="define-shape-type-select"
        class="text-xs font-medium text-neutral-600 dark:text-neutral-400"
      >
        {{ "defineShape.shapeType" | transloco }}
      </label>
      <select
        id="define-shape-type-select"
        [value]="shapeType()"
        (change)="onShapeTypeChange($event)"
        class="w-full px-2 py-1.5 text-xs border border-neutral-300/70 rounded bg-white dark:border-neutral-700/70 dark:bg-neutral-900 dark:text-neutral-100"
      >
        <option id="define-shape-type-filled-option" value="filled">
          {{ "defineShape.typeFilled" | transloco }}
        </option>
        <option id="define-shape-type-outlined-option" value="outlined">
          {{ "defineShape.typeOutlined" | transloco }}
        </option>
        <option id="define-shape-type-both-option" value="both">
          {{ "defineShape.typeBoth" | transloco }}
        </option>
      </select>
    </div>

    <div id="define-shape-corner-radius-row" class="space-y-1">
      <label
        id="define-shape-corner-radius-label"
        for="define-shape-corner-radius-input"
        class="text-xs font-medium text-neutral-600 dark:text-neutral-400"
      >
        {{ "defineShape.cornerRadius" | transloco }}: {{ cornerRadius() }}px
      </label>
      <input
        id="define-shape-corner-radius-input"
        type="range"
        min="0"
        max="50"
        step="1"
        [value]="cornerRadius()"
        (input)="onCornerRadiusChange($event)"
        class="w-full accent-blue-500"
      />
    </div>

    <div id="define-shape-path-smoothing-row" class="space-y-1">
      <label
        id="define-shape-path-smoothing-label"
        for="define-shape-path-smoothing-input"
        class="text-xs font-medium text-neutral-600 dark:text-neutral-400"
      >
        {{ "defineShape.pathSmoothing" | transloco }}:
        {{ pathSmoothingPercent }}%
      </label>
      <input
        id="define-shape-path-smoothing-input"
        type="range"
        min="0"
        max="100"
        step="1"
        [value]="pathSmoothingPercent"
        (input)="onPathSmoothingChange($event)"
        class="w-full accent-blue-500"
      />
    </div>

    <div id="define-shape-live-preview-row" class="flex items-center gap-2">
      <input
        id="define-shape-live-preview-checkbox"
        type="checkbox"
        [checked]="livePreviewEnabled()"
        (change)="onLivePreviewChange($event)"
        class="rounded-sm"
        aria-describedby="define-shape-live-preview-description"
      />
      <label
        id="define-shape-live-preview-label"
        for="define-shape-live-preview-checkbox"
        class="text-xs text-neutral-600 dark:text-neutral-400"
      >
        {{ "defineShape.livePreview" | transloco }}
      </label>
      <span id="define-shape-live-preview-description" class="sr-only">
        {{ "defineShape.livePreview" | transloco }}
      </span>
    </div>

    <div id="define-shape-actions-row" class="flex gap-2 pt-2">
      <button
        id="define-shape-save-button"
        type="button"
        (click)="onSave()"
        class="flex-1 px-3 py-1.5 text-xs rounded bg-blue-500 text-white hover:bg-blue-600 focus:ring-2 focus:ring-blue-500 focus:ring-offset-1"
      >
        {{ "defineShape.save" | transloco }}
      </button>
      <button
        id="define-shape-cancel-button"
        type="button"
        (click)="onCancel()"
        class="flex-1 px-3 py-1.5 text-xs rounded border border-neutral-300/70 text-neutral-700 hover:bg-neutral-100 dark:border-neutral-700/70 dark:text-neutral-300 dark:hover:bg-neutral-700/70"
      >
        {{ "defineShape.cancel" | transloco }}
      </button>
    </div>
  }
</div>
