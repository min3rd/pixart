<pa-modal
  [isOpen]="visible()"
  [title]="'pixelGeneration.title' | transloco"
  [size]="'md'"
  [modalId]="'pixel-generation-dialog'"
  [showCloseButton]="false"
  (onClose)="handleCancel()"
>
  <div
    id="pixel-generation-dialog-container"
    class="bg-white dark:bg-neutral-900 rounded-sm border border-neutral-200 dark:border-neutral-700 shadow-lg w-full max-w-2xl mx-4"
  >
    <div
      id="pixel-generation-dialog-header"
      class="px-4 py-3 border-b border-neutral-200 dark:border-neutral-700 flex items-center justify-between"
    >
      <div id="pixel-generation-dialog-title" class="flex items-center gap-2">
        <ng-icon
          name="heroIconsSparklesMini"
          class="w-5 h-5 text-neutral-700 dark:text-neutral-200"
        ></ng-icon>
        <h2
          id="pixel-generation-dialog-heading"
          class="text-base font-medium text-neutral-800 dark:text-neutral-100"
        >
          {{ "pixelGeneration.title" | transloco }}
        </h2>
      </div>
      <button
        type="button"
        id="pixel-generation-dialog-close"
        class="w-7 h-7 grid place-items-center rounded-sm hover:bg-neutral-100 dark:hover:bg-neutral-800"
        (click)="handleCancel()"
        [attr.aria-label]="'pixelGeneration.cancel' | transloco"
      >
        <ng-icon
          name="heroIconsXMarkMini"
          class="w-5 h-5 text-neutral-700 dark:text-neutral-200"
        ></ng-icon>
      </button>
    </div>

    <div id="pixel-generation-dialog-body" class="px-4 py-4">
      <div id="pixel-generation-dialog-source-info" class="mb-4">
        <div
          id="pixel-generation-dialog-source-label"
          class="text-xs text-neutral-600 dark:text-neutral-400 mb-2"
        >
          {{ sourceType() === "layer" ? ("pixelGeneration.sourceLayer" |
          transloco) : sourceType() === "visible" ?
          ("pixelGeneration.sourceVisible" | transloco) :
          ("pixelGeneration.sourceSelection" | transloco) }}
        </div>
        @if (sketchPreviewUrl()) {
        <div
          id="pixel-generation-dialog-preview"
          class="border border-neutral-300 dark:border-neutral-700 rounded-sm p-2 bg-neutral-50 dark:bg-neutral-950 flex items-center justify-center"
          [style.max-height.px]="200"
        >
          <img
            id="pixel-generation-dialog-preview-image"
            [src]="sketchPreviewUrl()"
            [alt]="'pixelGeneration.sketchPreview' | transloco"
            class="max-w-full max-h-full"
            [style.image-rendering]="'pixelated'"
          />
        </div>
        }
      </div>

      <div id="pixel-generation-dialog-prompt-section" class="mb-4">
        <label
          id="pixel-generation-dialog-prompt-label"
          for="pixel-generation-dialog-prompt-input"
          class="block text-sm font-medium text-neutral-700 dark:text-neutral-200 mb-2"
        >
          {{ "pixelGeneration.prompt" | transloco }}
        </label>
        <textarea
          id="pixel-generation-dialog-prompt-input"
          [(ngModel)]="prompt"
          [placeholder]="'pixelGeneration.promptPlaceholder' | transloco"
          class="w-full h-24 px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-sm bg-white dark:bg-neutral-800 text-neutral-800 dark:text-neutral-100 placeholder:text-neutral-400 dark:placeholder:text-neutral-500 resize-none"
          rows="4"
        ></textarea>
      </div>

      <div
        id="pixel-generation-dialog-dimensions"
        class="grid grid-cols-2 gap-4 mb-4"
      >
        <div id="pixel-generation-dialog-width-field">
          <label
            id="pixel-generation-dialog-width-label"
            for="pixel-generation-dialog-width-input"
            class="block text-xs text-neutral-600 dark:text-neutral-400 mb-1"
          >
            {{ "pixelGeneration.width" | transloco }}
          </label>
          <input
            id="pixel-generation-dialog-width-input"
            type="number"
            [(ngModel)]="width"
            min="1"
            max="512"
            class="w-full px-2 py-1 text-sm border border-neutral-300 dark:border-neutral-700 rounded-sm bg-white dark:bg-neutral-800 text-neutral-800 dark:text-neutral-100"
          />
        </div>
        <div id="pixel-generation-dialog-height-field">
          <label
            id="pixel-generation-dialog-height-label"
            for="pixel-generation-dialog-height-input"
            class="block text-xs text-neutral-600 dark:text-neutral-400 mb-1"
          >
            {{ "pixelGeneration.height" | transloco }}
          </label>
          <input
            id="pixel-generation-dialog-height-input"
            type="number"
            [(ngModel)]="height"
            min="1"
            max="512"
            class="w-full px-2 py-1 text-sm border border-neutral-300 dark:border-neutral-700 rounded-sm bg-white dark:bg-neutral-800 text-neutral-800 dark:text-neutral-100"
          />
        </div>
      </div>
    </div>

    <div
      id="pixel-generation-dialog-footer"
      class="px-4 py-3 border-t border-neutral-200 dark:border-neutral-700 flex items-center justify-end gap-2"
    >
      @if (generating()) {
      <div
        id="pixel-generation-dialog-status"
        class="flex items-center gap-2 mr-auto text-sm text-neutral-600 dark:text-neutral-400"
      >
        <div
          id="pixel-generation-dialog-spinner"
          class="w-4 h-4 border-2 border-neutral-400 dark:border-neutral-500 border-t-transparent rounded-full animate-spin"
        ></div>
        <span id="pixel-generation-dialog-status-text"
          >{{ "pixelGeneration.processing" | transloco }}</span
        >
      </div>
      }
      <button
        type="button"
        id="pixel-generation-dialog-cancel-button"
        class="px-4 py-2 text-sm rounded-sm border border-neutral-300 dark:border-neutral-700 text-neutral-700 dark:text-neutral-200 hover:bg-neutral-100 dark:hover:bg-neutral-800 disabled:opacity-50 disabled:cursor-not-allowed"
        (click)="handleCancel()"
        [disabled]="generating()"
      >
        {{ "pixelGeneration.cancel" | transloco }}
      </button>
      <button
        type="button"
        id="pixel-generation-dialog-generate-button"
        class="px-4 py-2 text-sm rounded-sm bg-neutral-800 dark:bg-neutral-200 text-white dark:text-neutral-900 hover:bg-neutral-700 dark:hover:bg-neutral-300 disabled:opacity-50 disabled:cursor-not-allowed"
        (click)="handleGenerate()"
        [disabled]="!prompt().trim() || generating()"
      >
        {{ "pixelGeneration.generate" | transloco }}
      </button>
    </div>
  </div>
</pa-modal>
